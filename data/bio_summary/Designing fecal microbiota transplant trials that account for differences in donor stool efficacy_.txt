select the donor with the maximum expected utility.an algorithm for counting the number of unique trial states as a function of the number n of patients treated derived in appendix 1 shows that a moderate-size trial with n 30 patients in the treatment arm has more than 10 million terminal trial states making this optimal approach infeasible.deterministic myopic allocation heuristicin light of the intractability of the optimal solution we formulated a myopic heuristic that rather than optimizing the expected utility of the entire trial simply assigns the next patient to the donor that maximizes the probability that that patient will have a successful outcome.

for example it would be sensible to take the actions that are most likely to lead to a trial with a significant p-value as measured by frequentist statistics so every terminal node with a significant p-value would have utility 1 and the others would have utility 0. different choices for the utility function would be appropriate under different circumstances and would lead to different strategies.equation 9 shows that the optimal donor choice at a nonterminal trial state depends only on the utility of its child nodes and each donor's probability of a successful treatment given that trial state.

biometrika 2007 94 673-689.appendix 1 mathematical appendix posterior probability of patient responselet si be the event that the next patient responds to treatment with stool from donor i. the posterior predictive probability of si ispdsijxth 14 z x pdsijp qth pdp qjxth dpd10thp qfflpfflfflofflfflstezrfflifflofflfflrfflthe probability pdsijp qth is simply peff is qi 14 1 and ppl if qi 14 0. thuspdsijxth  z rpefffeffbindsi ni peffthth ppld1 - feffthbindsi ni pplthlp fflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflffltfflefflfflrfflmfflfflfflfflffflfflorzdfflofflfflnfflfflofflfflrfflfflifflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflffld11thf bin s  n  p1fbin s  n  pj i fflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflffltfflefflrfflfflmfflfflsfflfflfflffflofflfflrfflfflotzhfflefflrfflfflffldfflfflofflnfflfflofflfflrfflsfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflp p dppfflrizofflrthe constant of proportionality is the same for all i the quantity in equation 11 should be divided bydp i141rfeffbindsi ni peffthth d1 - feffthbindsi ni pplthlpdpthdpd12thbecause the binomials in equations 11 and 12 have the same constants binds n pth can be replaced bypsd1 - pthf in these equations.counting trial stateshow many unique trial states are there for a given number of patients nnaively a trial state can be specified by a string that specifies which donor was used and what outcome was observed e.g.

using this model we describe the optimal adaptive bayesian strategy for allocating donors and then formulate a computationally tractable myopic bayesian allocation heuristic.using simulations of clinical trials we show that differences in donor efficacy and the trial's strategy for allocating donors can have substantial impacts on the trial's statistical power.

adaptive strategies however can substantially increase a trial's ability to detect if fmt is efficacious.model of differences in donor stool efficacythe results of the trial reported in moayyedi et al.10 raise the possibility that only some donors produce stool that is efficacious for treating ulcerative colitis a type of inflammatory bowel disease.

let a trial state be a trial with some set of observed patient outcomes.

thus the optimal choice at an intermediate trial state can be found by backward inductionassociate each terminal trial state i.e.

a trial with n patients can have up to n donors meaning that there are nn possible chains of donors and 2n possible chains of outcomes for 2n n possible trial states.however many of those states are identical.

thus a unique trial set is a set of ordered triples di si fi  where di is the number of donors that each have had si successful and fi failed patient outcomes.theorem 1. let wn m be the number of trial states with n0 total patients with at most m0 patients in any donor.

in simulations designed to mimic a recent fecal microbiota transplantation clinical trial for which traditional power calculations predict 100 statistical power we found that accounting for differences in donor stool efficacy reduced the predicted statistical power to 9. for these simulations using the heuristic bayesian allocation strategy more than quadrupled the statistical power to 39. we use the results of similar simulations to make recommendations about the number of patients the number of donors and the choice of clinical endpoint that clinical trials should use to optimize their ability to detect if fecal microbiota transplantation is effective for treating a condition.keywordsadaptive design bayesian statistics clinical trials fecal microbiota transplant inflammatory bowel disease1introductionfecal microbiota transplantation fmt the transfer of stool from a healthy person into an ill person's gut is a highly effective treatment for recurrent clostridium difficile infections which kill 30000 americans a year.

email ideally information collected before or during a clinical trial could be used to identify which donors are efficacious.

the fraction of donors in the general donor population that are efficacious is feff.fmt fecal microbiota transplantation.table 1. point estimates and hyperparameters for model parameters using clinical data.10 a and b are hyperparameters for a beta distribution.clinical trial resultparameterpoint estimateabtwo of 37 in placebo arm respondedppl237 14 0054235one of six donors appeared efficaciousfeff16 14 01715seven of 18 patients allocated to theefficacious donor respondedpeff718 14 039711ingredient efficacy pingr 4 0 and the remaining donors have pingr 0 i.e.

in one set of simulations we articulated these priors using beta distributionsppl ingrd ppl pingrth 14 betad ppl apl bplthx betad peff apeff bpeffthd4thpfeffd feffth 14 betad feff afeff bfeffthd5thwhere the hyperparameters adth and bdth can be drawn from prior clinical trial results.

we chose to model the prior on pingr via a beta distribution on peff because peff is directly observable in terms of patient outcomes while pingr can only be back computed from peff and ppl via equation 1. the clinical trial results for moayyedi et al.10 and their translation into the model parameters and prior hyperparameters are presented in table 1.we model the prior on the donor qualities q as a function of feff the fraction of donors in the general population that are efficacious asdpdqj feffth 14 feffif qi 14 1d6thi1411 - feff if qi 14 0the data used to update the priors are the numbers of patients treated successfully and unsuccessfully for each donor.

the integrator was implemented in c using the cuba package.14 wrappers for the integration routine were implemented in python 3 and simulations were then parallelized to run on multiple cores to optimize computational run time.15optimal donor allocationgiven the priors on the model parameters and the observed patient outcomes what is the optimal choice for the next donor answering this question requires evaluating the ramifications that a donor choice will have for the next patient as well as for the trial as a whole.the problem of allocation of patients to donors within the treatment arm is similar to other ''bandit'' problems.16 in general bandit problems treat how to allocate patients between the placebo arm and the treatment arm or arms.

