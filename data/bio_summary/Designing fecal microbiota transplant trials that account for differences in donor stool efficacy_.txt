Select the donor with the maximum expected utility.An algorithm for counting the number of unique trial states as a function of the number N of patients treated derived in Appendix 1 shows that a moderate-size trial with N 30 patients in the treatment arm has more than 10 million terminal trial states making this optimal approach infeasible.Deterministic myopic allocation heuristicIn light of the intractability of the optimal solution we formulated a myopic heuristic that rather than optimizing the expected utility of the entire trial simply assigns the next patient to the donor that maximizes the probability that that patient will have a successful outcome.

For example for the parameterization most similar to the one in Table 1 the random strategy allocated 15 of patients to efficacious donors while the myopic Bayesian strategy allocated 41 of patients to efficacious donors.Trials using adaptive allocation have higher statistical powerBecause trials that used the adaptive donor allocation strategies allocated more patients to efficacious donors than the trials that used the nonadaptive strategies and because an equal number of patients were allocated to theFigure 2.

ThusPdSijXTh  Z rpefffeffBindsi ni peffThth ppld1 - feffThBindsi ni pplThlp fflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflffltfflefflfflrfflmfflfflfflfflffflfflorzdfflofflfflnfflfflofflfflrfflfflifflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflffld11Thf Bin s  n  p1fBin s  n  pj i fflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflffltfflefflrfflfflmfflfflsfflfflfflffflofflfflrfflfflotzhfflefflrfflfflffldfflfflofflnfflfflofflfflrfflsfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflfflP p dppfflrizofflrThe constant of proportionality is the same for all i the quantity in equation 11 should be divided byDp i141rfeffBindsi ni peffThth d1 - feffThBindsi ni pplThlPdpThdpd12ThBecause the binomials in equations 11 and 12 have the same constants Binds n pTh can be replaced bypsd1 - pThf in these equations.Counting trial statesHow many unique trial states are there for a given number of patients NNaively a trial state can be specified by a string that specifies which donor was used and what outcome was observed e.g.

Previous clinical trials using FMT for inflammatory bowel disease IBD have randomized patients to the placebo and treatment arms in a 11 ratio.1017 To remain consistent with this practice we assume that patients have been allocated equally to the placebo and treatment arms and only study strategies for the allocation of patients to donors within the treatment arm.Given this constraint we formulate an optimal donor allocation strategy.

For example if there are 30 patients and six donors the first five patients are treated with the first donor the second five patients are treated with the second donor etc.

The integrator was implemented in C using the Cuba package.14 Wrappers for the integration routine were implemented in Python 3 and simulations were then parallelized to run on multiple cores to optimize computational run time.15Optimal donor allocationGiven the priors on the model parameters and the observed patient outcomes what is the optimal choice for the next donor Answering this question requires evaluating the ramifications that a donor choice will have for the next patient as well as for the trial as a whole.The problem of allocation of patients to donors within the treatment arm is similar to other ''bandit'' problems.16 In general bandit problems treat how to allocate patients between the placebo arm and the treatment arm or arms.

those with N patients treated with a utility.For each trial state with N1 patients treated compute the expected utility of each donor choice.

endoscopic Mayo score1017 or 0.25 a high placebo rate consistent with self-reported subjective outcomes2526.The efficacy peff of efficacious donors is either 0.4 similar to the value in Table 1 or 0.95 efficacy of FMT to treat C. difficile infection.The frequency feff of efficacious donors is either 0.15 similar to the value in Table 1 or 0.9 reflective of the fact that almost any well-screened donor produces stool that can successfully treat C. difficile infection.The number of patients in each of the placebo and treatment arms is 15 30 or 60 corresponding to a range of patient numbers typical for Phase I and small Phase II clinical trials.Of these combinations the set of values most similar to the one in Table 1 is ppl 14 005peff 14 04 feff 14 015 Npatients 14 30.Computing statistical powerAfter determining the outcome of all the patients in the trial the p-value of a one-sided Fisher's exact test asserting that the response rate in the treatment arm was greater was calculated.

Let wN M be the number of trial states with N0 total patients with at most M0 patients in any donor.

A trial with N patients can have up to N donors meaning that there are NN possible chains of donors and 2N possible chains of outcomes for 2N N possible trial states.However many of those states are identical.

