this can be used for data in both fasta and fastq formats.input files read file.output files new file with primer removed.use strict use warnings use cwdmy fwprimers 14 agagtttgatcctggctcag tacggraggcagc ag gccagcagccgcggtaa aggattagataccct gaattgacgg ggrccc gyaacgagcgcaacccmy dir 14 getcwd opendirdir dir or die while my file 14 readdirdir  next if file 14 mnext if file 14 m. print fileopenin file or die my outfile 14 deprimer.file openoutoutfilewhilemy line 14 inforeach my aprimer fwprimersline 14saprimergline 14sg print out line closeout closeinclosedirdir exit 02. the barcode extraction command can be used twice to remove both the barcode and primer .input files read.fastq file metadata file.output files directory of output files including barcode file and read files.extractbarcodes.py -f read file -m metadata file -o output directory nameperforming quality filteringfor data in fastq format.quality filtering in qiime is performed as part of splitli- brariesfastq.py see note 1. the following command can be executed to combine all the fastq files into one.input files 1 directory of multiple fastq read files 2 parame- ter file.output files directory of output files including seqs.fna file which are used to select otus.multiplesplitlibrariesfastq.py -i input directory -p file path or name of parameter file -o output directoryfor data in fasta format.quality filtering can be conducted by following the three steps described below.step 1 clean the data to remove the incompatible lines and make the file compatible with qiime see note 2.input files fasta read files.output files directory of output fasta files.cleanfasta.py -f read file name -o output file direc- torystep 2 use splitmetadata.py and splitlibrary.py to transform from the previous combined fasta file format into another fasta format by parsing the sequences that meet user-defined quality thresholds and then renaming each read with the appropriate sample id  .step 3 concatenate all the fasta files using cat in linux.input files multiple fasta read files.

the number of species with exactly two occurrences in the sample and is calculated as follows suppose sobs is thenumber of species for the sample a1 is the number of singletonsand a2is the number of doubletons then chao1a14 sobsa122a22higher estimated value represents more diversity within the sample.the chao1 a diversity index is particularly useful for microbiome datasets skewed to low abundance classes while a drawback of the chao1 a diversity index is that when the sample size is low it underestimates the true value .abundance-based coverage estimatorthe abundance-based coverage estimator ace   measures the a diversity by separating the species into two groups an abun- dant species group and a rare species group.

for example in table  the weighted unifrac dissimilarity between sample srr1023240 and sample srr1023582 is 0.37 and the weighted unifrac dissimilarity between sample srr1023263 and srr1023240 is 0.41.normalized unweighted unifrac measure unweightedunifnorm-unifracbiomsample weighted14false normalized14truetable shows the results for the normalized unweighted uni- frac dissimilarity which is 0.82 between sample srr1023460 and sample srr1023240 and 0.80 between sample srr1023240 and sample srr1023582.normalized weighted unifrac measure weightedunifnorm-unifracbiomsample weighted14true normalized14truetable 7normalized weighted unifrac measure for the foregut esophageal adenocarcinoma datasettable provides the results of the normalized weighted uni- frac measure for the foregut esophageal adenocarcinoma dataset.

the calculation of the ace is described below .given that f1 is the number of singleton species fk is thenumber of species with exactly k taxa and sobs is the total number of species in the sample the number of rare species is described assrare 14 p10 f  and the number of abundant species is denoted asksabund 14 psobsf k assuming the value of 10 is the threshold.

x 0 naj th nbj log naj thnbj  - naj log nbj - nbj log naj 1 where naj is the counts of taxa for species j in sample a nbj is the counts of taxa for species j in sample b and n is the total number of species present in the two samples.in this formula the numerator summandnaj th nbjthe dissimilarity between two samples.

output files directory of output files including seqs.fna demultiplexedsequences.log seqs.qual and seqsnotas- signed.fnademultiplexfasta.py -f read.fasta file -m metadata mapping file -o output directory namefor data in fastq formatthe function of splitlibrariesfastq.py can demultiplex sequences from a data file in the fastq format in which the barcodes and sequences are stored in two separate fastq files .input data files 1 read.fastq file 2 barcode fastq file.

biom -o table.frombiomwtaxonomy2.txt --to-tsvuse r library to read the .txt file and convert to otus .input files file in the tab-delimited table format from previous biom conversion step.output files otu object of compositions in the framework of aitchison simplex by acomp or compositions as elements of simplex embedded in d-dimensional real space by rcomp.install.packagescompositions librarycompositionssample-read.tabletable.frombiomwtaxonomy2.txt countssample-sample-1tctsample-tcountssample closuretsample-clotctsample compsample-acompclosuretsampleorrealsample-rcompclosuretsampleread .biom file and phylogenetic tree information into r using the phyloseq package install phyloseq packagesourcehttpsbioconductor.orgbioclite.r bioclitephyloseqorinstall.packagesdevtools librarydevtools installgithubphyloseq joey711 libraryphyloseqimport .biom fileinput files 1 biom file 2 tree file.

all reads in the sample are clustered by the open-reference approach .input files fasta file seqs.fna.output files directory of output files including a phylogenetic tree file and a biom-formatted otu table.pickopenreferenceotus.py -i input read file -o output directory namesummary of the otu tableafter selecting the otu we can summarize the generated otu table in terms of the number of samples the number of observa- tions and a summary of the total counts observed for each sample .

the shannon diversity index is calculated as follows suppose n is the total number of species and pi is the proportion of species i relative to the total number of species in a communitypnhigher values of the shannon diversity index represent more diver- sity within a community a value of 0 means the community has only one species.

a drawback to the de novo approach is that there is no existing support for parallel computing in qiime which may slow down the process .input files fasta file seqs.fna which is a fasta file after demultiplexing.output files directory of output files including a phylogenetic tree file and a biom-formatted otu table.pickdenovootus.py -i input read file -o output directory namethe second approach for selecting the otu is closed-reference otu picking where reads are clustered against a reference.

for example for sample srr1023240 simpson's index is 0.98 which means that within the sample the probability that two randomly selected taxa belong to the same species is as high as 0.98. we used the coefficient of variation to compare the different alpha diversity measures see note 3.plot richness graph  plot alpha diversity plotrichnessbiomsample measures14cobserved chao1 ace shannon simpson invsimpson fisherfigure shows the richness of each sample using different alpha diversity measures including the observed richness chao1 ace shannon simpson's inverse simpson's and fisher index.

1 flowchart of basic steps in handling raw microbiome sequencing dataraw microbiome sequencing data and extracting the otus using qiime are provided in subheading .demultiplexing if multiple samples are pooled in one single lane by using the sample index or barcode adapters then the step of demultiplexing is needed to divide one file of sequencing reads into separate files where one file corre- sponds to one sample .removing barcodes high-throughput sequencing allows multiple different independent samples to be sequenced dur- ing a single run.

the metadata mapping file usually contains the following information the name of each sample barcode sequence for each sample primer sequence used to amplify the sample and a descrip- tive column for example health status sampling site or which medications a patient was taking at the time of sampling .figure shows the basic procedure for processing the raw microbiome sequencing data.

simpson'sdiversity index is given as l 14n i141p2 where n is the total numberof species and pi is the proportion of species i relative to the total number of species in a community .

however the inverse simpson's diversity index is biased when estimating numer- ous species that have low abundance within a community .fisher's a diversity index fisher's a diversity index describes the relationship between the number of species and the number of individuals of the corresponding species by logarithmic distribution.

